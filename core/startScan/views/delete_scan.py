import json
import os
from datetime import datetime

import markdown
from django.contrib import messages
from django.db.models import Count
from django.http import HttpResponse, HttpResponseRedirect, JsonResponse
from django.shortcuts import get_object_or_404, render
from django.template.loader import get_template
from django.urls import reverse
from django.utils import timezone
from django_celery_beat.models import (ClockedSchedule, IntervalSchedule,
                                       PeriodicTask)
from weasyprint import HTML

from core.celery import app
from core.common_func import *
from core.scanEngine.models import EngineType, VulnerabilityReportSetting
from core.startScan.models import *
from core.targetApp.models import Domain, project
from core.tasks import create_scan_activity, initiate_scan


def delete_scan(request, id):
    obj = get_object_or_404(ScanHistory, id=id)
    if request.method == "POST":
        delete_dir = obj.results_dir
        os.system("rm -rf /usr/src/scan_results/" + delete_dir)
        obj.delete()
        messageData = {"status": "true"}
        messages.add_message(
            request, messages.INFO, "Scan history successfully deleted!"
        )
    else:
        messageData = {"status": "false"}
        messages.add_message(request, messages.INFO, "Oops! something went wrong!")
    return JsonResponse(messageData)
