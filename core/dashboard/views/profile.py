from datetime import timedelta

from django.contrib import messages
from django.contrib.auth import update_session_auth_hash
from django.contrib.auth.decorators import login_required
from django.contrib.auth.forms import PasswordChangeForm
from django.contrib.auth.signals import user_logged_in, user_logged_out
from django.db.models import CharField, Count, Q, Value
from django.db.models.functions import TruncDay
from django.dispatch import receiver
from django.http import HttpResponse
from django.shortcuts import redirect, render
from django.utils import timezone

from core.startScan.models import *
from core.targetApp.models.domain import Domain


def profile(request):
    if request.method == "POST":
        form = PasswordChangeForm(request.user, request.POST)
        if form.is_valid():
            user = form.save()
            update_session_auth_hash(request, user)
            messages.success(request, "Your password was successfully changed!")
            return redirect("profile")
        else:
            messages.error(request, "Please correct the error below.")
    else:
        form = PasswordChangeForm(request.user)
    return render(request, "dashboard/profile.html", {"form": form})
