import csv
import io
import os
import threading
from datetime import timedelta
from functools import reduce
from operator import and_, or_

import requests
import validators
from django import http
from django.conf import settings
from django.contrib import messages
from django.db.models import Count, Q
from django.shortcuts import get_object_or_404, render
from django.urls import reverse
from django.utils import timezone
from django.utils.safestring import mark_safe

from core.common_func import *
from core.scanEngine.forms import *
from core.scanEngine.models import *
from core.startScan.models import *
from core.targetApp.forms import *
from core.targetApp.forms.add_project import AddProjectForm
from core.targetApp.forms.add_target import AddTargetForm
from core.targetApp.forms.update_project import UpdateProjectForm
from core.targetApp.forms.update_target import UpdateTargetForm
from core.targetApp.models import *


def delete_target(request, id):
    obj = get_object_or_404(Domain, id=id)
    if request.method == "POST":
        os.system("rm -rf " + settings.TOOL_LOCATION + "scan_results/" + obj.name + "*")
        obj.delete()
        responseData = {"status": "true"}
        messages.add_message(request, messages.INFO, "Domain successfully deleted!")
    else:
        responseData = {"status": "false"}
        messages.add_message(
            request, messages.ERROR, "Oops! Domain could not be deleted!"
        )
    return http.JsonResponse(responseData)
