from django import forms

from core.targetApp.models import Domain, Project
from core.validators import validate_domain

class AddProjectForm(forms.Form):
    def __init__(self, *args, **kwargs):
        super(AddProjectForm, self).__init__(*args, **kwargs)
        self.fields["domains"].choices = [
            (domain.id, domain.name) for domain in Domain.objects.all()
        ]

    name = forms.CharField(
        required=True,
        widget=forms.TextInput(
            attrs={
                "class": "form-control form-control-lg",
                "id": "projectName",
                "placeholder": "Project Name",
            }
        ),
    )

    description = forms.CharField(
        required=False,
        widget=forms.TextInput(
            attrs={
                "class": "form-control form-control-lg",
                "id": "projectDescription",
            }
        ),
    )

    domains = forms.ChoiceField(
        required=True,
        widget=forms.Select(
            attrs={
                "class": "form-control select2-multiple",
                "multiple": "multiple",
                "data-toggle": "select2",
                "data-width": "100%",
                "data-placeholder": "Choose Targets",
                "id": "domains",
            }
        ),
    )

    def clean_name(self):
        data = self.cleaned_data["name"]
        if Project.objects.filter(name=data).count() > 0:
            raise forms.ValidationError("{} Project already exists".format(data))
        return data
