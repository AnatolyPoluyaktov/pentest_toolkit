from django.db.models import F, JSONField, Value
from rest_framework import serializers

from core.common_func import *
from core.dashboard.models import *
from core.recon_note.models import *
from core.scanEngine.models import *
from core.startScan.models import *
from core.targetApp.models import Domain, Project


class SubScanSerializer(serializers.ModelSerializer):

    subdomain_name = serializers.SerializerMethodField("get_subdomain_name")
    time_taken = serializers.SerializerMethodField("get_total_time_taken")
    elapsed_time = serializers.SerializerMethodField("get_elapsed_time")
    completed_ago = serializers.SerializerMethodField("get_completed_ago")
    engine = serializers.SerializerMethodField("get_engine_name")

    class Meta:
        model = SubScan
        fields = "__all__"

    def get_subdomain_name(self, sub_scan):
        return sub_scan.subdomain.name

    def get_total_time_taken(self, sub_scan):
        return sub_scan.get_total_time_taken()

    def get_elapsed_time(self, sub_scan):
        return sub_scan.get_elapsed_time()

    def get_completed_ago(self, sub_scan):
        return sub_scan.get_completed_ago()

    def get_engine_name(self, sub_scan):
        if sub_scan.engine:
            return sub_scan.engine.engine_name
        return ""
