from django.db.models import F, JSONField, Value
from rest_framework import serializers

from core.common_func import *
from core.dashboard.models import *
from core.recon_note.models import *
from core.scanEngine.models import *
from core.startScan.models import *
from core.targetApp.models import Domain, Project


class SubdomainChangesSerializer(serializers.ModelSerializer):

    change = serializers.SerializerMethodField("get_change")

    is_interesting = serializers.SerializerMethodField("get_is_interesting")

    class Meta:
        model = Subdomain
        fields = "__all__"

    def get_change(self, Subdomain):
        return Subdomain.change

    def get_is_interesting(self, Subdomain):
        return (
            get_interesting_subdomains(Subdomain.scan_history.id)
            .filter(name=Subdomain.name)
            .exists()
        )
